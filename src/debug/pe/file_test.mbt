// Copyright 2009 The Go Authors. All rights reserved.
// Use of this source code is governed by a BSD-style
// license that can be found in the LICENSE file.

///|
/// Test data structure to hold file test information
struct FileTest {
  file : String
  hdr : FileHeader
  opthdr : OptionalHeader?
  sections : Array[SectionHeader]
  symbols : Array[Symbol]
  has_no_dwarf_info : Bool
} derive(Show, Eq, ToJson)

///|
/// Test data array containing various PE file test cases
let file_tests : Array[FileTest] = [
  {
    file: "testdata/gcc-386-mingw-obj",
    hdr: {
      machine: 0x014c,
      number_of_sections: 0x000c,
      time_date_stamp: 0x0,
      pointer_to_symbol_table: 0x64a,
      number_of_symbols: 0x1e,
      size_of_optional_header: 0x0,
      characteristics: 0x104,
    },
    opthdr: None,
    sections: [
      {
        name: ".text",
        virtual_size: 0,
        virtual_address: 0,
        size: 36,
        offset: 500,
        pointer_to_relocations: 1440,
        pointer_to_line_numbers: 0,
        number_of_relocations: 3,
        number_of_line_numbers: 0,
        characteristics: 0x60300020,
      },
      {
        name: ".data",
        virtual_size: 0,
        virtual_address: 0,
        size: 0,
        offset: 0,
        pointer_to_relocations: 0,
        pointer_to_line_numbers: 0,
        number_of_relocations: 0,
        number_of_line_numbers: 0,
        characteristics: 3224371264,
      },
      {
        name: ".bss",
        virtual_size: 0,
        virtual_address: 0,
        size: 0,
        offset: 0,
        pointer_to_relocations: 0,
        pointer_to_line_numbers: 0,
        number_of_relocations: 0,
        number_of_line_numbers: 0,
        characteristics: 3224371328,
      },
      {
        name: ".debug_abbrev",
        virtual_size: 0,
        virtual_address: 0,
        size: 137,
        offset: 536,
        pointer_to_relocations: 0,
        pointer_to_line_numbers: 0,
        number_of_relocations: 0,
        number_of_line_numbers: 0,
        characteristics: 0x42100000,
      },
      {
        name: ".debug_info",
        virtual_size: 0,
        virtual_address: 0,
        size: 418,
        offset: 673,
        pointer_to_relocations: 1470,
        pointer_to_line_numbers: 0,
        number_of_relocations: 7,
        number_of_line_numbers: 0,
        characteristics: 1108344832,
      },
      {
        name: ".debug_line",
        virtual_size: 0,
        virtual_address: 0,
        size: 128,
        offset: 1091,
        pointer_to_relocations: 1540,
        pointer_to_line_numbers: 0,
        number_of_relocations: 1,
        number_of_line_numbers: 0,
        characteristics: 1108344832,
      },
      {
        name: ".rdata",
        virtual_size: 0,
        virtual_address: 0,
        size: 16,
        offset: 1219,
        pointer_to_relocations: 0,
        pointer_to_line_numbers: 0,
        number_of_relocations: 0,
        number_of_line_numbers: 0,
        characteristics: 1076887616,
      },
      {
        name: ".debug_frame",
        virtual_size: 0,
        virtual_address: 0,
        size: 52,
        offset: 1235,
        pointer_to_relocations: 1550,
        pointer_to_line_numbers: 0,
        number_of_relocations: 2,
        number_of_line_numbers: 0,
        characteristics: 1110441984,
      },
      {
        name: ".debug_loc",
        virtual_size: 0,
        virtual_address: 0,
        size: 56,
        offset: 1287,
        pointer_to_relocations: 0,
        pointer_to_line_numbers: 0,
        number_of_relocations: 0,
        number_of_line_numbers: 0,
        characteristics: 1108344832,
      },
      {
        name: ".debug_pubnames",
        virtual_size: 0,
        virtual_address: 0,
        size: 27,
        offset: 1343,
        pointer_to_relocations: 1570,
        pointer_to_line_numbers: 0,
        number_of_relocations: 1,
        number_of_line_numbers: 0,
        characteristics: 1108344832,
      },
      {
        name: ".debug_pubtypes",
        virtual_size: 0,
        virtual_address: 0,
        size: 38,
        offset: 1370,
        pointer_to_relocations: 1580,
        pointer_to_line_numbers: 0,
        number_of_relocations: 1,
        number_of_line_numbers: 0,
        characteristics: 1108344832,
      },
      {
        name: ".debug_aranges",
        virtual_size: 0,
        virtual_address: 0,
        size: 32,
        offset: 1408,
        pointer_to_relocations: 1590,
        pointer_to_line_numbers: 0,
        number_of_relocations: 2,
        number_of_line_numbers: 0,
        characteristics: 1108344832,
      },
    ],
    symbols: [
      {
        name: ".file",
        value: 0x0,
        section_number: -2,
        type_: 0x0,
        storage_class: 0x67,
      },
      {
        name: "_main",
        value: 0x0,
        section_number: 1,
        type_: 0x20,
        storage_class: 0x2,
      },
      {
        name: ".text",
        value: 0x0,
        section_number: 1,
        type_: 0x0,
        storage_class: 0x3,
      },
      {
        name: ".data",
        value: 0x0,
        section_number: 2,
        type_: 0x0,
        storage_class: 0x3,
      },
      {
        name: ".bss",
        value: 0x0,
        section_number: 3,
        type_: 0x0,
        storage_class: 0x3,
      },
      {
        name: ".debug_abbrev",
        value: 0x0,
        section_number: 4,
        type_: 0x0,
        storage_class: 0x3,
      },
      {
        name: ".debug_info",
        value: 0x0,
        section_number: 5,
        type_: 0x0,
        storage_class: 0x3,
      },
      {
        name: ".debug_line",
        value: 0x0,
        section_number: 6,
        type_: 0x0,
        storage_class: 0x3,
      },
      {
        name: ".rdata",
        value: 0x0,
        section_number: 7,
        type_: 0x0,
        storage_class: 0x3,
      },
      {
        name: ".debug_frame",
        value: 0x0,
        section_number: 8,
        type_: 0x0,
        storage_class: 0x3,
      },
      {
        name: ".debug_loc",
        value: 0x0,
        section_number: 9,
        type_: 0x0,
        storage_class: 0x3,
      },
      {
        name: ".debug_pubnames",
        value: 0x0,
        section_number: 10,
        type_: 0x0,
        storage_class: 0x3,
      },
      {
        name: ".debug_pubtypes",
        value: 0x0,
        section_number: 11,
        type_: 0x0,
        storage_class: 0x3,
      },
      {
        name: ".debug_aranges",
        value: 0x0,
        section_number: 12,
        type_: 0x0,
        storage_class: 0x3,
      },
      {
        name: "___main",
        value: 0x0,
        section_number: 0,
        type_: 0x20,
        storage_class: 0x2,
      },
      {
        name: "_puts",
        value: 0x0,
        section_number: 0,
        type_: 0x20,
        storage_class: 0x2,
      },
    ],
    has_no_dwarf_info: false,
  },
  {
    file: "testdata/gcc-386-mingw-exec",
    hdr: {
      machine: 0x014c,
      number_of_sections: 0x000f,
      time_date_stamp: 0x4c6a1b60,
      pointer_to_symbol_table: 0x3c00,
      number_of_symbols: 0x282,
      size_of_optional_header: 0xe0,
      characteristics: 0x107,
    },
    opthdr: Some(
      Header32({
        magic: 0x10b,
        major_linker_version: 0x2,
        minor_linker_version: 0x38,
        size_of_code: 0xe00,
        size_of_initialized_data: 0x1a00,
        size_of_uninitialized_data: 0x200,
        address_of_entry_point: 0x1160,
        base_of_code: 0x1000,
        base_of_data: 0x2000,
        image_base: 0x400000,
        section_alignment: 0x1000,
        file_alignment: 0x200,
        major_operating_system_version: 0x4,
        minor_operating_system_version: 0x0,
        major_image_version: 0x1,
        minor_image_version: 0x0,
        major_subsystem_version: 0x4,
        minor_subsystem_version: 0x0,
        win32_version_value: 0x0,
        size_of_image: 0x10000,
        size_of_headers: 0x400,
        check_sum: 0x14abb,
        subsystem: 0x3,
        dll_characteristics: 0x0,
        size_of_stack_reserve: 0x200000,
        size_of_stack_commit: 0x1000,
        size_of_heap_reserve: 0x100000,
        size_of_heap_commit: 0x1000,
        loader_flags: 0x0,
        number_of_rva_and_sizes: 0x10,
        data_directory: [
          { virtual_address: 0x0, size: 0x0 },
          { virtual_address: 0x5000, size: 0x3c8 },
          { virtual_address: 0x0, size: 0x0 },
          { virtual_address: 0x0, size: 0x0 },
          { virtual_address: 0x0, size: 0x0 },
          { virtual_address: 0x0, size: 0x0 },
          { virtual_address: 0x0, size: 0x0 },
          { virtual_address: 0x0, size: 0x0 },
          { virtual_address: 0x0, size: 0x0 },
          { virtual_address: 0x7000, size: 0x18 },
          { virtual_address: 0x0, size: 0x0 },
          { virtual_address: 0x0, size: 0x0 },
          { virtual_address: 0x0, size: 0x0 },
          { virtual_address: 0x0, size: 0x0 },
          { virtual_address: 0x0, size: 0x0 },
          { virtual_address: 0x0, size: 0x0 },
        ],
      }),
    ),
    sections: [],
    symbols: [],
    has_no_dwarf_info: false,
  },
]
